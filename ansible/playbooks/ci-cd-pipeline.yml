---
- name: ğŸš€ WordPress CI/CD Pipeline
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: "1. âœ… Checkout Code"
      git:
        repo: "{{ github_repo }}"
        dest: "/tmp/wordpress-deploy"
        version: "{{ branch }}"
      when: github_repo is defined

    - name: "2. ğŸ” Run Tests"
      shell: |
        cd /tmp/wordpress-deploy
        # Add your test commands here
        echo "Running tests..."
      when: github_repo is defined

    - name: "3. ğŸ³ Build & Push Docker Image"
      include_role:
        name: wordpress-deploy
        tasks_from: build-image.yml
      when: build_image | default(false)

    - name: "4. ğŸš€ Deploy to ECS"
      include_role:
        name: wordpress-deploy

    - name: "5. âœ… Health Check"
      include_role:
        name: wordpress-deploy
        tasks_from: health-check.yml

    - name: "6. ğŸ“Š Deployment Status"
      debug:
        msg: |
          ğŸ‰ DEPLOYMENT COMPLETE!
          ======================
          WordPress successfully deployed to ECS
          Service: {{ ecs_service }}
          Cluster: {{ ecs_cluster }}
          Region: {{ aws_region }}
